<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Журнал клієнтів фітнес-тренера</title>

    <!-- Bootstrap для базових стилів -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Власні стилі (як у Lab3, але трохи покращені) -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container mt-4">

    <!-- Заголовок сторінки -->
    <h2 class="text-center text-success mb-4">
        Журнал клієнтів фітнес-тренера
    </h2>

    <!-- Форма додавання клієнта -->
    <div class="card-like mb-3">
        <div class="row g-2">

            <div class="col-md-3">
                <input id="name" class="form-control" placeholder="Ім’я">
            </div>

            <div class="col-md-2">
                <input id="age" type="number" class="form-control" placeholder="Вік">
            </div>

            <div class="col-md-2">
                <input id="weight" type="number" class="form-control" placeholder="Вага">
            </div>

            <div class="col-md-3">
                <select id="goal" class="form-select">
                    <option>Схуднення</option>
                    <option>Набір</option>
                    <option>Підтримка форми</option>
                </select>
            </div>

            <div class="col-md-2 d-grid">
                <button class="btn btn-success" onclick="addClient()">
                    Додати
                </button>
            </div>

        </div>
    </div>

    <!-- Поле пошуку -->
    <input id="search" class="form-control mb-2"
           placeholder="Пошук по імені..."
           oninput="loadClients()">

    <!-- Вибір сортування -->
    <select id="sort" class="form-select mb-3" onchange="loadClients()">
        <option value="name">Сортувати за ім’ям</option>
        <option value="age">Сортувати за віком</option>
        <option value="weight">Сортувати за вагою</option>
    </select>

    <!-- Таблиця клієнтів -->
    <table class="table table-bordered table-striped">
        <thead class="table-success">
            <tr>
                <th>Ім’я</th>
                <th>Вік</th>
                <th>Вага</th>
                <th>Ціль</th>
                <th>Дії</th>
            </tr>
        </thead>
        <tbody id="table"></tbody>
    </table>

</div>

<script>
// ------------------------------
// Завантаження списку клієнтів
// ------------------------------
async function loadClients() {
    const search = document.getElementById("search").value;
    const sort = document.getElementById("sort").value;

    const response = await fetch(`/clients?search=${search}&sort=${sort}`);
    const data = await response.json();

    const table = document.getElementById("table");
    table.innerHTML = "";

    data.forEach(client => {
        table.innerHTML += `
            <tr>
                <td>${client.name}</td>
                <td>${client.age}</td>
                <td>${client.weight}</td>
                <td>${client.goal}</td>
                <td>
                    <button class="btn btn-warning btn-sm me-1"
                        onclick="editClient(
                            '${client._id}',
                            '${client.name}',
                            ${client.age},
                            ${client.weight},
                            '${client.goal}'
                        )">
                        Редагувати
                    </button>

                    <button class="btn btn-danger btn-sm"
                        onclick="deleteClient('${client._id}')">
                        Видалити
                    </button>
                </td>
            </tr>
        `;
    });
}

// ------------------------------
// Додавання нового клієнта
// ------------------------------
async function addClient() {
    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value;
    const weight = document.getElementById("weight").value;
    const goal = document.getElementById("goal").value;

    if (!name || !age || !weight) {
        alert("Будь ласка, заповніть усі поля");
        return;
    }

    await fetch("/clients", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, age, weight, goal })
    });

    // очищення форми
    document.getElementById("name").value = "";
    document.getElementById("age").value = "";
    document.getElementById("weight").value = "";

    loadClients();
}

// ------------------------------
// Редагування клієнта
// ------------------------------
async function editClient(id, name, age, weight, goal) {
    const newName = prompt("Нове ім’я:", name);
    const newAge = prompt("Новий вік:", age);
    const newWeight = prompt("Нова вага:", weight);
    const newGoal = prompt("Нова ціль:", goal);

    if (!newName || !newAge || !newWeight || !newGoal) return;

    await fetch(`/clients/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            name: newName,
            age: newAge,
            weight: newWeight,
            goal: newGoal
        })
    });

    loadClients();
}

// ------------------------------
// Видалення клієнта
// ------------------------------
async function deleteClient(id) {
    if (!confirm("Ви дійсно хочете видалити клієнта?")) return;

    await fetch(`/clients/${id}`, { method: "DELETE" });
    loadClients();
}

// ------------------------------
// Автозавантаження при старті
// ------------------------------
loadClients();
</script>
</body>
</html>